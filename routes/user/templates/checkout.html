{% extends "base.html" %}
{% block base_title %}Checkout{% endblock %}

{% block base_head %}
    {{ super() }}
    <link rel="stylesheet" type="text/css" href="/static/user/css/checkout.css">
{% endblock %}

{% block mainTitle %}
    <div class="text-left" id="welcome">
        <p class="primary-lg" id="account-holder">Checkout.</p>
    </div>
{% endblock %}
<!-- Page Content -->
{% block main %}
    <div class="container wow fadeIn">
        <div class="row">
            <div class="col-lg-7 col-xl-8 col-xxl-9 mb-4">
                <div class="card">
                    <form action="{{ url_for('user_bp.checkout') }}" id="dummyForm">
                        <div class="card-body">
                            <h3 class="complement-bold mb-4 card-title">Shipping & Billing Information</h3>
                            <div class="row my-row">
                                <div class="col-xxl-6">
                                    <div class="d-inline-block w-100">
                                        <div class="custom-control custom-radio mr-2 d-inline-block">
                                            <input type="radio" class="custom-control-input" id="chooseShippingToggle"
                                                   name="shippingToggleGroup" checked>
                                            <label class="custom-control-label mb-2" for="chooseShippingToggle"
                                                   id="chooseShippingToggleLabel">Choose a Shipping
                                                Address</label>
                                        </div>
                                        <a data-toggle="collapse" class="float-right" data-target="#addressEntry"
                                           href=""
                                           id="addressToggler">View</a>
                                    </div>
                                    <label for="shippingAddressSelect" class="d-none"></label>
                                    {% if shipping_payload|length != 0 %}
                                        <select class="custom-select d-block w-100 mb-3 checkout-select"
                                                id="shippingAddressSelect">
                                            {% for id,payload in shipping_payload.items() %}
                                                <option nile-shipping-street1="{{ payload['street1'] }}"
                                                        nile-shipping-street2="{{ payload['street2'] }}"
                                                        nile-shippping-zip="{{ payload['zip'] }}"
                                                        nile-shipping-city="{{ payload['city'] }}"
                                                        nile-shipping-state="{{ payload['state'] }}"
                                                        nile-shipping-country="{{ payload['country'] }}"
                                                        nile-shipping-ident="{{ id }}">

                                                    {{ payload['street1'] }} {{ payload['street2'] }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    {% endif %}

                                    <div class="ship-radio-holder">
                                        <div class="custom-control custom-radio mr-2">
                                            <input type="radio" class="custom-control-input" id="enterAddressToggle"
                                                   name="shippingToggleGroup">
                                            <label class="custom-control-label mb-2" for="enterAddressToggle">New
                                                Shipping
                                                Address</label>
                                        </div>
                                    </div>


                                    <div id="addressEntry" class="collapse checkout-readonly">
                                        <small>
                                            <span class="text-muted font-italic ml-2 mb-1">Shipping Information</span>
                                        </small>
                                        <small class="float-right">
                                            <a href="{{ url_for('user_bp.shipping_address') }}"
                                               class="font-italic mr-1">Edit
                                                Information</a>
                                        </small>
                                        <div class="card-specific">
                                            <div class="form-row">
                                                <div class="col">
                                                    <div class="form-group md-form md-outline">
                                                        <input type="text" class="form-control"
                                                               id="checkoutAddressStreetAddress"
                                                               name="addressStreetAddress"
                                                               maxlength="45"
                                                               required>
                                                        <label for="checkoutAddressStreetAddress">Street Address</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="col">
                                                    <div class="form-group md-form md-outline">
                                                        <input type="text" class="form-control"
                                                               id="checkoutAddressApartmentOrSuite"
                                                               maxlength="45"
                                                               name="addressApartmentOrSuite">
                                                        <label for="checkoutAddressApartmentOrSuite">Apartment or
                                                            Suite</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="col">
                                                    <div class="form-group md-form md-outline">
                                                        <input type="text" class="form-control" id="checkoutAddressZip"
                                                               maxlength="10"
                                                               name="addressZip">
                                                        <label for="checkoutAddressZip">ZIP or Postal code</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group col-md-5">
                                                    <div class="form-group md-form md-outline">
                                                        <input type="text" class="form-control" id="checkoutAddressCity"
                                                               required
                                                               maxlength="45"
                                                               name="addressCity">
                                                        <label for="checkoutAddressCity">City</label>
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-2" style="margin-top: 8px">
                                                    <label for="checkoutAddressState" class="d-none">State</label>
                                                    <select id="checkoutAddressState"
                                                            class="form-control" required
                                                            name="addressState">
                                                        <option value="" disabled selected>State</option>
                                                        <option value="GA">GA</option>
                                                        <option value="CA">CA</option>
                                                    </select>

                                                </div>
                                                <div class="form-group col-md-5" style="margin-top: 8px">
                                                    <label for="checkoutAddressCountry" class="d-none">Country</label>
                                                    <select id="checkoutAddressCountry"
                                                            class="form-control"
                                                            required
                                                            name="addressCountry">
                                                        <option value="" disabled selected>Country</option>
                                                        <option value="United States">United States</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                    <div id="newAddressEntry" class="collapse">
                                        <div class="custom-control custom-checkbox my-2">
                                            <input type="checkbox" class="custom-control-input remember-me"
                                                   id="rememberShipping"
                                                   value="0">
                                            <label class="custom-control-label" for="rememberShipping">Remember this
                                                next
                                                time</label>
                                        </div>
                                        <small>
                                            <span class="text-muted font-italic ml-2 mb-1">Shipping Information</span>
                                        </small>
                                        <div class="card-specific">
                                            <div class="form-row">
                                                <div class="col">
                                                    <div class="form-group md-form md-outline">
                                                        <label for="newAddressStreetAddress">New Address</label>
                                                        <input type="text" class="form-control"
                                                               id="newAddressStreetAddress"
                                                               name="addressStreetAddress"
                                                               maxlength="45"
                                                               required>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="col">
                                                    <div class="form-group md-form md-outline">
                                                        <label for="newAddressApartmentOrSuite">Apartment or
                                                            Suite</label>
                                                        <input type="text" class="form-control valid"
                                                               id="newAddressApartmentOrSuite"
                                                               maxlength="45"
                                                               name="addressApartmentOrSuite">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="col">
                                                    <div class="form-group md-form md-outline">
                                                        <label for="newAddressZip">ZIP or Postal code</label>
                                                        <input type="text" class="form-control" id="newAddressZip"
                                                               maxlength="10"
                                                               required
                                                               name="addressZip">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group col-md-5">
                                                    <div class="form-group md-form md-outline">
                                                        <label for="newAddressCity">City</label>
                                                        <input type="text" class="form-control" id="newAddressCity"
                                                               maxlength="45"
                                                               required
                                                               name="addressCity">
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-2" style="margin-top: 8px">
                                                    <label for="newAddressState" class="d-none">State</label>
                                                    <select id="newAddressState"
                                                            class="form-control" required
                                                            name="addressState">
                                                        <option value="" disabled selected>--</option>
                                                        <option value="GA">GA</option>
                                                        <option value="CA">CA</option>
                                                    </select>

                                                </div>
                                                <div class="form-group col-md-5" style="margin-top: 8px">
                                                    <label for="newAddressCountry" class="d-none">Country</label>
                                                    <select id="newAddressCountry"
                                                            class="form-control"
                                                            required
                                                            name="addressCountry">
                                                        <option value="" disabled selected>--</option>
                                                        <option value="United States">United States</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr class="entry-seperation-border d-none">
                                <div class="col-xxl-6">
                                    <div class="custom-control custom-radio d-inline-block w-100">
                                        <input type="radio" class="custom-control-input d-inline-block"
                                               id="choosePaymentMethodToggle"
                                               name="paymentToggleGroup" checked>
                                        <label class="custom-control-label mb-2" for="choosePaymentMethodToggle"
                                               id="choosePaymentMethodToggleLabel">Choose a Payment
                                            Method</label>
                                        <a data-toggle="collapse" class="float-right" data-target="#paymentMethodEntry"
                                           href=""
                                           id="paymentMethodToggler">View</a>
                                    </div>

                                    {% if billing_payload|length != 0 %}
                                        <label for="paymentMethodSelect" class="d-none"></label>
                                        <select class="custom-select d-block w-100 mb-3 checkout-select"
                                                id="paymentMethodSelect">
                                            {% for id,payload in billing_payload.items() %}
                                                <option
                                                        nile-card-fname="{{ payload['card_fname'] }}"
                                                        nile-card-lname="{{ payload['card_lname'] }}"
                                                        nile-card-expiry="{{ payload['card_expiry'] }}"
                                                        nile-billing-street1="{{ payload['street1'] }}"
                                                        nile-billing-street2="{{ payload['street2'] }}"
                                                        nile-billing-zip="{{ payload['zip'] }}"
                                                        nile-billing-city="{{ payload['city'] }}"
                                                        nile-billing-state="{{ payload['state'] }}"
                                                        nile-billing-country="{{ payload['country'] }}"
                                                        nile-pm-ident="{{ id }}">
                                                    {{ payload['card_lname'] }}
                                                    - {{ payload['card_type'] }} {{ payload['card_number'] }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                    {% endif %}

                                    <div class="pm-radio-holder">
                                        <div class="custom-control custom-radio">
                                            <input type="radio" class="custom-control-input"
                                                   id="enterPaymentMethodToggle"
                                                   name="paymentToggleGroup">
                                            <label class="custom-control-label mb-2" for="enterPaymentMethodToggle">New
                                                Payment
                                                Method</label>
                                        </div>
                                    </div>

                                    <div id="paymentMethodEntry" class="collapse checkout-readonly">
                                        <small>
                                            <span class="text-muted font-italic ml-2 mb-1">Card Information</span>
                                        </small>
                                        <small class="float-right">
                                            <a href="{{ url_for('user_bp.payment_methods') }}" class="font-italic mr-1">Edit
                                                Information</a>
                                        </small>
                                        <div class="card-specific">
                                            <div class="form-row">
                                                <div class="col-sm-6">
                                                    <div class="form-group md-form md-outline">
                                                        <input type="text" class="form-control"
                                                               id="checkoutCardHolderFirstName"
                                                               required
                                                               name="cardHolderFirstName"
                                                               style="text-transform: uppercase;"
                                                               maxlength="45"
                                                               data-error="First Name must me more than one character">
                                                        <label for="checkoutCardHolderFirstName">First Name on
                                                            Card</label>
                                                    </div>
                                                </div>
                                                <div class="col-sm-6">
                                                    <div class="form-group md-form md-outline">
                                                        <input type="text" class="form-control"
                                                               id="checkoutCardHolderLastName"
                                                               required
                                                               name="cardHolderLastName"
                                                               style="text-transform: uppercase;"
                                                               maxlength="45"
                                                               data-error="Last Name must me more than two characters">
                                                        <label for="checkoutCardHolderLastName">Last Name on
                                                            Card</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="col">
                                                    <div class="form-group">
                                                        <label for="checkoutCCEXP">Credit Card Expiration Date</label>
                                                        <input type="month" class="form-control" id="checkoutCCEXP"
                                                               required
                                                               name="ccexp">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <small>
                                            <span class="text-muted font-italic ml-2 mb-1">Billing Information</span>
                                        </small>
                                        <div class="billing-address">
                                            <div class="form-row">
                                                <div class="col">
                                                    <div class="form-group md-form md-outline">
                                                        <input type="text" class="form-control"
                                                               id="checkoutBillingStreetAddress"
                                                               required
                                                               name="billingStreetAddress"
                                                               maxlength="45"
                                                               data-error="Street Address cannot be empty">
                                                        <label for="checkoutBillingStreetAddress">Street Address</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="col">
                                                    <div class="form-group md-form md-outline">
                                                        <input type="text" class="form-control valid"
                                                               id="checkoutBillingApartmentOrSuite" aria-invalid="false"
                                                               maxlength="45"
                                                               name="billingApartmentOrSuite"
                                                               data-success="This field is optional">
                                                        <label for="checkoutBillingApartmentOrSuite">Apartment or Suite
                                                            (Optional)</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="col">
                                                    <div class="form-group md-form md-outline">
                                                        <input type="text" class="form-control"
                                                               id="checkoutBillingAddressZip"
                                                               maxlength="10"
                                                               name="billingAddressZip">
                                                        <label for="checkoutBillingAddressZip">ZIP or Postal
                                                            code</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group col-md-5">
                                                    <div class="form-group md-form md-outline">
                                                        <input type="text" class="form-control"
                                                               id="checkoutBillingAddressCity"
                                                               required
                                                               maxlength="45"
                                                               name="billingAddressCity">
                                                        <label for="checkoutBillingAddressCity">City</label>
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-2" style="margin-top: 8px">
                                                    <label for="checkoutBillingAddressState"
                                                           class="d-none">State</label>
                                                    <select id="checkoutBillingAddressState"
                                                            class="form-control" required
                                                            name="billingAddressState">
                                                        <option value="" disabled selected>--</option>
                                                        <option value="GA">GA</option>
                                                        <option value="CA">CA</option>
                                                    </select>

                                                </div>
                                                <div class="form-group col-md-5" style="margin-top: 8px">
                                                    <label for="checkoutBillingAddressCountry"
                                                           class="d-none">Country</label>
                                                    <select id="checkoutBillingAddressCountry"
                                                            class="form-control"
                                                            required
                                                            name="billingAddressCountry">
                                                        <option value="" disabled selected>--</option>
                                                        <option value="United States">United States</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div id="newPaymentMethodEntry" class="collapse">
                                        <div class="custom-control custom-checkbox my-2">
                                            <input type="checkbox" class="custom-control-input remember-me"
                                                   id="rememberPM"
                                                   value="0">
                                            <label class="custom-control-label" for="rememberPM">Remember this next
                                                time</label>
                                        </div>
                                        <small>
                                            <span class="text-muted font-italic mb-1 ml-1">Card Information</span>
                                        </small>
                                        <div class="card-specific">
                                            <div class="form-row">
                                                <div class="col-sm-6">
                                                    <div class="form-group md-form md-outline">
                                                        <input type="text" class="form-control"
                                                               id="newCardHolderFirstName"
                                                               required
                                                               name="cardHolderFirstName"
                                                               style="text-transform: uppercase;"
                                                               maxlength="45"
                                                               data-error="First Name must me more than one character">
                                                        <label for="newCardHolderFirstName">First Name</label>
                                                    </div>
                                                </div>
                                                <div class="col-sm-6">
                                                    <div class="form-group md-form md-outline">
                                                        <input type="text" class="form-control"
                                                               id="newCardHolderLastName"
                                                               required
                                                               name="cardHolderLastName"
                                                               style="text-transform: uppercase;"
                                                               maxlength="45"
                                                               data-error="Last Name must me more than two characters">
                                                        <label for="newCardHolderLastName">Last Name</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="col-sm-9">
                                                    <div class="form-group md-form md-outline">
                                                        <label for="newCCN">Credit Card Number</label>
                                                        <input type="text" class="form-control" id="newCCN" name="ccn"
                                                               required
                                                               credit-provider=""
                                                               data-error="Credit Card is not valid.">
                                                    </div>
                                                </div>
                                                <div class="col-sm-3">
                                                    <div class="form-group md-form md-outline">
                                                        <input type="text" class="form-control" id="newCVV" name="cvv"
                                                               required
                                                               maxlength="3"
                                                               data-error="CVV is not valid.">
                                                        <label for="newCVV">CVV</label>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="col">
                                                    <div class="form-group">
                                                        <label for="newCCEXP">Credit Card Expiration Date</label>
                                                        <input type="month" class="form-control" id="newCCEXP" required
                                                               name="ccexp">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <small>
                                            <span class="text-muted font-italic mb-1 ml-1">Billing Address</span>
                                        </small>
                                        <div class="billing-address">
                                            <div class="form-row">
                                                <div class="col">
                                                    <div class="form-group md-form md-outline">
                                                        <label for="newBillingStreetAddress">Street Address</label>
                                                        <input type="text" class="form-control"
                                                               id="newBillingStreetAddress"
                                                               required
                                                               name="billingStreetAddress"
                                                               maxlength="45"
                                                               data-error="Street Address cannot be empty">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="col">
                                                    <div class="form-group md-form md-outline">
                                                        <label for="newBillingApartmentOrSuite">Apartment or Suite
                                                            (Optional)</label>
                                                        <input type="text" class="form-control valid"
                                                               id="newBillingApartmentOrSuite" aria-invalid="false"
                                                               maxlength="45"
                                                               name="billingApartmentOrSuite"
                                                               data-success="This field is optional">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="col">
                                                    <div class="form-group md-form md-outline">
                                                        <label for="newBillingAddressZip">ZIP or Postal code</label>
                                                        <input type="text" class="form-control"
                                                               id="newBillingAddressZip"
                                                               maxlength="10"
                                                               required
                                                               name="billingAddressZip">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-row">
                                                <div class="form-group col-md-5">
                                                    <div class="form-group md-form md-outline">
                                                        <label for="newBillingAddressCity">City</label>
                                                        <input type="text" class="form-control"
                                                               id="newBillingAddressCity"
                                                               required
                                                               maxlength="45"
                                                               name="billingAddressCity">
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-2" style="margin-top: 8px">
                                                    <label for="newBillingAddressState" class="d-none">State</label>
                                                    <select id="newBillingAddressState"
                                                            class="form-control" required
                                                            name="billingAddressState">
                                                        <option value="" disabled selected>--</option>
                                                        <option value="GA">GA</option>
                                                        <option value="CA">CA</option>
                                                    </select>

                                                </div>
                                                <div class="form-group col-md-5" style="margin-top: 8px">
                                                    <label for="newBillingAddressCountry" class="d-none">Country</label>
                                                    <select id="newBillingAddressCountry"
                                                            class="form-control"
                                                            required
                                                            name="billingAddressCountry">
                                                        <option value="" disabled selected>--</option>
                                                        <option value="United States">United States</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer">
                            <button type="button" class="btn blue-gradient btn-lg btn-block waves-effect waves-ripple"
                                    id="checkoutBtn">
                                Place Order
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="col-lg-5 col-xl-4 col-xxl-3 mb-4" id="page-wrap">
                <div id="sidebar">
                    <h4 class="d-flex justify-content-between align-items-center mb-3">
                        <span class="text-muted">Your cart</span>
                        <span class="badge blue-gradient badge-pill"> {{ book_payload.keys()|length }}</span>
                    </h4>
                    <!-- Cart -->
                    <ul class="list-group mb-3 z-depth-1 cart-items">
                        {% for isbn, payload in book_payload.items() %}
                            <li class="list-group-item d-flex justify-content-between lh-condensed">
                                <div>
                                    <h6 class="my-0 complement">{{ payload['title'] }}<small>
                                        x{{ payload['quantity'] }}</small></h6>
                                    <small class="text-muted"><i
                                            class="checkoutSideBarISBN">ISBN: {{ isbn }}</i></small>
                                    <h6 class="my-0 complement">
                                        <small class="text-muted"><i>${{ payload['price'] }} each</i></small>
                                    </h6>

                                </div>
                                <span class="text-muted complement">$<span
                                        class="sidebar-item-price pl-0">{{ payload['total_price'] }}</span></span>
                            </li>
                        {% endfor %}
                        <li class="list-group-item d-flex justify-content-between">

                            <span class="complement">Shipping Cost</span>
                            <strong class="text-danger">+ $<span class="sidebar-item-price pl-0"
                                                                 id="shippingTotal">{{ "%.2f"|format(shipping_price) }}</span></strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span class="complement">Sales Tax</span>
                            <strong class="text-danger">+ $<span id="salesTax"></span></strong>

                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span class="complement-bold">GRAND TOTAL (USD)</span>
                            <strong class="primary-md">$<span id="checkoutTotalPrice">{{ book_total }}</span></strong>
                        </li>
                    </ul>
                    <!-- Cart -->
                    <!-- Promo code -->
                    <form class="card p-2">
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="Promo code"
                                   aria-label="Recipient's username" aria-describedby="basic-addon2"
                                   onkeyup="this.value = this.value.toUpperCase();">
                            <div class="input-group-append">
                                <button class="btn blue-gradient btn-md waves-effect m-0 ml-2" type="button">Redeem
                                </button>
                            </div>
                        </div>
                    </form>
                    <a href="{{ url_for('common_bp.shopping_cart') }}">
                        <button class="btn btn-outline-primary btn-block rounded waves-effect waves-ripple mt-3"
                                id="backToCartBtn">
                            <i class="fa fa-chevron-left"></i>
                            Back to Cart
                        </button>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <script type="module" src="/static/user/js/checkout/checkout.js"></script>
{% endblock %}